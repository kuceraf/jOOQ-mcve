package org.jooq.mcve.test.kotlin

import org.jooq.DSLContext
import org.jooq.impl.DSL
import org.jooq.mcve.kotlin.tables.references.FILM
import org.junit.After
import org.junit.Before
import org.junit.Test
import java.sql.DriverManager

class KotlinTest {

    var connection: java.sql.Connection? = null
    var ctx: DSLContext? = null

    @Before
    fun setup() {
        // postgresql://localhost/sakila?user=postgres&password=postgres
        connection = DriverManager.getConnection("jdbc:postgresql://localhost/sakila", "postgres", "postgres")
        ctx = DSL.using(connection)
        //ctx().delete(TEST).execute()
    }

    @After
    fun after() {
        ctx = null
        connection!!.close()
        connection = null
    }

    fun ctx(): DSLContext = ctx!!

//    @Test
//    fun mcveTest() {
//        assertEquals(1, ctx()
//            .insertInto(TEST)
//            .columns(TEST.CD)
//            .values(42)
//            .execute()
//        )
//
//        val record = ctx().fetchOne(TEST, TEST.CD.eq(42))
//        assertNotNull(record?.id)
//    }

    @Test
    fun selectTest() {
        ctx().selectFrom(FILM)
            .fetch {
                println(it)
            }
    }
}